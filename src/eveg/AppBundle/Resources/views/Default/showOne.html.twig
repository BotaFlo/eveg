{# src/eveg/AppBundle/Resources/views/Default/viewOne.html.twig #}

{% extends "::layout.html.twig" %}

{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('css/fancytree/skin-win8/ui.fancytree.min.css') }}" type="text/css" />
	{{ parent() }}
{% endblock %}

{% block title %}
	{% if syntaxon is defined %}
		{{ syntaxon.syntaxonName }} | {{ parent() }}
	{% endif %}
	{% if multipleSyntaxon is defined %}
		Plusieurs résultats | {{ parent() }}
	{% endif %}
{% endblock %}

{% block body %}

	{{ parent() }}


	{% if redirectionSyntaxon is defined %}
		<p>Vous avez été redirigé vers le syntaxon retenu pour votre recherche concernant "<span class="{{ redirectionSyntaxon.level }}-text">{{ redirectionSyntaxon.syntaxon }}</span>".</p>
	{% endif %}

	{% if redirectionMultipleSyntaxon is defined %}
		<p>Plusieurs syntaxons correpondent à votre recherche concernant "<span class="{{ redirectionMultipleSyntaxon.level }}-text">{{ redirectionMultipleSyntaxon.syntaxon }}</span>".</p>
	{% endif %}

	{% if redirectionFromSynonym is defined %}
		<p>Vous avez été redirigé vers le syntaxon retenu pour votre recherche concernant "<span class="{{ redirectionFromSynonym.level }}-text">{{ redirectionFromSynonym.syntaxon }}</span></p>
	{% endif %}

	{% if syntaxon is defined %}
		{#{{ dump(syntaxon) }}#}
		{#{{ dump(synonyms) }}#}
	{% endif %}

	{% if multipleSyntaxon is defined %}
		{#{{ dump(multipleSyntaxon) }}#}
	{% endif %}

	{% if allParents is defined %}
		{#{{ dump(allParents) }}#}
	{% endif %}

	{% if syntaxon is defined %}

		{# Flashbags #}
		{% for type, messages in app.session.flashBag.all %}
		    {% for message in messages %}
		        {%if type == 'error'%} {% set type = 'danger' %} {%endif%}
		        <div class="alert alert-{{ type }} alert-dismissible">
		        	<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		            {{ message|raw }}
		        </div>
		    {% endfor %}
		{% endfor %}

		{# SearchBar #}
		<div class="row">
			<div class="col-md-4 hidden-xs hidden-sm"></div>
			<div class="col-md-8">
				{# Searchbox #}
				<div class="row searchRow">
					<div class="right-inner-addon">
						<i class="searchIcon glyphicon glyphicon-refresh glyphicon-refresh-animate"></i>
						<span class="badge-addon badge">X</span>
						<input type="text" class="form-control searchbox" name="term" id ="searchbox" placeholder="Rechercher une végétation">
					</div>
				</div>
			</div>
		</div>

		<div class="row appShowRow">

			<div class="col-md-4 hidden-xs hidden-sm" id="divTree">
				<div>
					
				</div>
				<i class="loadTreeIcon glyphicon glyphicon-refresh glyphicon-refresh-animate"></i>
			</div>

			{# show data #}
			<div class="col-md-8" id="showOneResult">

				{# Header #}
				<div class="row viewHeader-{{ syntaxon.level }}">
					<h1>{{ syntaxon.syntaxonName }} <span class="viewHeaderAuthor">{{ syntaxon.syntaxonAuthor }}</span></h1>
					<h2>{{syntaxon.commonName}}</h2>
				</div>

				{# Breadcrumb #}
				<div class="row flexBreadcrumb hidden-xs hidden-sm">
						{% for syntaxon in allParents %}
							{% if syntaxon.level != 'HAB' %}
								<div class="flexBreadcrumbItem"><a href="{{ path('eveg_show_one', {'id': syntaxon.id}) }}" class="{{ syntaxon.level }}-text">{{ syntaxon.syntaxon }}</a></div>

								{% if not loop.last %}
									<span class="breadcrumbSeparator">/</span>
								{% endif %}
							{% endif %}
						{% endfor %}
				</div>

				{# Breadcrumb for xm & xs views#}
				<div class="row hidden-lg hidden-md">
					{% for syntaxon in allParents %}
						{% if syntaxon.level != 'HAB' %}
								<a href="{{ path('eveg_show_one', {'id': syntaxon.id}) }}" class="{{ syntaxon.level }}-text {{ syntaxon.level }}-indent">{{ syntaxon.syntaxon }}</a><br />
						{% endif %}
					{% endfor %}
				</div>

				{# Data #}
				<div class="row">
					<div class="col-md-8 viewLeft">

						{# Synonyms #}
						{% if synonyms is defined %}
							<div class="panel panel-default">
								<div class="panel-heading panelSynonymsHeader">Synonymes{% if synonyms is empty %} : aucun synonyme trouvé{% endif %}<span class="synonymsShowAll pull-right">Afficher tout</span></div>
								<ul class="list-group">
									{% for synonym in synonyms %}
										<li class="list-group-item synonymBox">
											{{ synonymType(synonym.level)|raw }}
											<a href="{{ path('eveg_show_one', {'id': synonym.id}) }}">
												{{ synonym.syntaxon }}
											</a>
										</li>
									{% endfor %}
								</ul>
							</div> <!-- ./ panel -->
						{% endif %}
						<p>

						{# Ecological specifications #}
						<div class="panel panel-default">
							<div class="panel-heading">Caractéristiques écologiques</div>
							<div class="panel-body">
								Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
							</div>
						</div>

						{# Floristic cortege #}
						<div class="panel panel-default">
							<div class="panel-heading">Cortège floristique</div>
							<div class="panel-body">
								Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
							</div>
						</div>

						{# Resources #}
						<div class="panel panel-default">
							<div class="panel-heading">Ressources</div>
							<div class="panel-body">
								Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
							</div>
						</div>

						{# Bibliography #}
						<div class="panel panel-default">
							<div class="panel-heading">Bibliographie</div>
							<div class="panel-body">
								Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
							</div>
						</div>

					</div> <!-- ./viewLeft -->

					<div class="col-md-4 viewRight">
						<i>
							Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
						</i>
					</div> <!-- ./viewRight -->
				</div> <!-- ./row -->
			</div> <!-- ./col-md-8 -->
		</div>
	{% endif %}

{% endblock %}

{% block javascript %}
	{{ parent() }}
	<script>
		$(".loadTreeIcon").hide();
	</script>
	<!-- FANCY TREE -->
	<script src="{{ asset('js/jquery.fancytree-all.js') }}" type="text/javascript"></script>
	<!-- Initialize the tree when page is loaded -->
	<script src="{{ asset('js/treeApp.js') }}" type="text/javascript"></script>

	<!-- AUTOCOMPLETE -->
	<script src="{{ asset('js/autocomplete.js') }}" type="text/javascript"></script>
	<script>
		$('.searchIcon').hide();
		$('.badge-addon').hide();
		monkeyPatchAutocomplete();
		$('#searchbox').autocomplete({
			source: '{{ url("api_get_syntaxon_search") }}',
			minLength: 3,
			search: function(event, ui) {
				$('.badge-addon').hide();
				$('.searchIcon').show();
			},
			response: function(event, ui) {
				$('.searchIcon').hide();
				$('.badge-addon').text(ui.content.length);
				$('.badge-addon').show();
			},
			focus: function(event, ui) {
		        event.preventDefault();
		    },
		    change: function(event, ui) {
		    	$('.badge-addon').hide();
		    },
		    close: function(event, ui) {
		    	$('.badge-addon').hide();
		    },
			select : function(event, ui){
				event.preventDefault();
				//alert( Routing.generate('api_get_syntaxon_node', { id: ui.item.id }, true) );
				window.location.replace(Routing.generate('eveg_show_one', { id: ui.item.id }, true));
				$('.badge-addon').hide();
			}
		});
	</script>

	<!-- RESIZABLE -->
	<!--
	<script src="{{ asset('js/resizable.js') }}" type="text/javascript"></script>
	<script>
		$("#divTree").resizable({
	        alsoResizeReverse: "#notTree"
	    });
	</script>
	-->

	<!-- EXPAND NODES -->
	<script>
		{% if syntaxon is defined%}
			function expandNodes(){
				$(".loadTreeIcon").show();
				var tree = $("#divTree").fancytree("getTree");
				tree.loadKeyPath("{% if allParents is defined %}{% for parent in allParents %}/{{ parent.id }}{% endfor %}/{{ syntaxon.id}}{% endif %}", function(node, status){
				  
				  if(status === "loaded") {
				    //console.log("loaded intermiediate node " + node);
				  }
				  
				  if(status === "ok") {
				    tree.activateKey("{{ syntaxon.id }}");
				    $(".loadTreeIcon").hide();
				  }


				  //console.debug("node [" + node + "]: " + status)
				});
			}
		{% endif %}
	</script>

	<!-- BOOTSTRAP TOOLTIP -->
	<script>
		$(".showTooltip").tooltip({html:true});
		//$(".showTooltip").tooltip('show')
	</script>

	<!-- LIMIT THE NUMBER OF VISIBLE ITEMS -->
	<script>
		function limitResults(label, item, click){
			// label : node to be shown / hidden
			// item : node to limit repetition
			// click : click this element to toggle
			$(label).hide();
			var limit = 3;
			var synonymsExpand = false;
			var nbSynonyms = $(item).size();
			var strExpand = 'Afficher tout (' + nbSynonyms + ')';
			var strMini = 'Réduire';
			$(label).html(strExpand);
			//console.log($('.synonymsBox').size());
			if(nbSynonyms >= limit) {
				synonymsExpand = true;
				$(item).slice(limit).hide();
				$(label).show();
			}
			$(click).click(function(){
				if(synonymsExpand == true) {
					$(item).show();
					$(label).html(strMini);
					synonymsExpand = false
				} else {
					$(item).slice(limit).hide();
					$(label).html(strExpand);
					synonymsExpand = true;
				}	
			});	
		}

		limitResults(".synonymsShowAll", ".synonymBox", ".panelSynonymsHeader");
		
		
	</script>

{% endblock %}